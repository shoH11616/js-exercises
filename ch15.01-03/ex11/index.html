<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EVENT propagation, dispatch</title>
    <script type="module">
      window.onload = function () {
        const div = document.querySelector("#div");
        const btn = document.querySelector("#btn");

        div.addEventListener(
          "click",
          () => {
            console.log("div");
          },
          { capture: false }
        );

        btn.addEventListener("click", () => {
          console.log("button");
        });

        class RandomEventTarget extends EventTarget {
          constructor() {
            super();
          }

          trigger() {
            const randomNumber = new CustomEvent("random", {
              detail: Math.random(),
            });
            this.dispatchEvent(randomNumber);
          }
        }

        const randomEventTarget = new RandomEventTarget();

        // 1. htmlのpタグ要素を生成しなさい。また、ボタン要素の直後の位置にpタグ要素を配置しなさい。
        const p = document.createElement("p");
        div.appendChild(p);

        randomEventTarget.addEventListener("random", (e) => {
          // 2. 生成済みのpタグ要素のテキストに、イベントの保持する乱数値を代入しなさい。
          p.textContent = e.detail;
        });

        // 3. ボタンにイベントリスナを追加し、ボタン押下するごとに乱数値を変更しなさい。変更にはRandomEventTargetのtriggerメソッドを利用しなさい。
        btn.addEventListener("click", () => {
          randomEventTarget.trigger();
        });

        // 4. RandomEventTargetのtriggerメソッドによってイベントを発生させて、ページ読み込み時に乱数値を表示しなさい。
        randomEventTarget.trigger();
      };
    </script>
  </head>
  <body>
    <div id="div">
      <button id="btn">ボタン</button>
      <!-- コンソールにはdivとbuttonという文字列が出力 -->
      <!-- { capture: false }にすると順序が逆になる -->
      <!-- clickとloadイベントが登録されている -->
    </div>
  </body>
</html>
